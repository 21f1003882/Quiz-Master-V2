{% extends "base.html" %}

{% block title %}User Activity: {{ user.username }}{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="{{ url_for('admin.dashboard') }}">Admin Dashboard</a></li>
    <li class="breadcrumb-item"><a href="{{ url_for('admin.summary') }}">Summary</a></li>
    <li class="breadcrumb-item active" aria-current="page">User Activity</li>
  </ol>
</nav>

<h1 class="mb-4">User Activity: {{ user.username }}</h1>
<p><strong>Email:</strong> {{ user.email }}</p>

<div class="card shadow-sm">
    <div class="card-header">Quiz Attempt History</div>
    <div class="card-body">
         {% if attempts %}
            <table class="table table-hover table-sm"> {# table-sm for denser table #}
                <thead>
                    <tr>
                        <th>Quiz Title</th>
                        <th>Chapter</th>
                        <th>Subject</th>
                        <th>Score</th>
                        <th>Percentage</th>
                        <th>Date Submitted</th>
                        <th>Time Taken</th>
                        {# Add link to view detailed answers later? #}
                    </tr>
                </thead>
                <tbody>
                    {% for attempt in attempts %}
                        <tr>
                            <td>{{ attempt.quiz.title }}</td>
                            <td>{{ attempt.quiz.chapter.name }}</td>
                            <td>{{ attempt.quiz.chapter.subject.name }}</td>
                            <td>{{ attempt.score }} / {{ attempt.total_questions }}</td>
                            <td>{{ "%.1f"|format(attempt.percentage_score) }}%</td>
                            <td>
                                {% if attempt.submitted_at %}
                                    {{ attempt.submitted_at.strftime('%Y-%m-%d %H:%M:%S') }} {# More precise time #}
                                {% else %}
                                    <span class="">Incomplete</span>
                                {% endif %}
                            </td>
                             <td>
                                {# Use the same filter as user summary #}
                                {{ attempt.time_taken | timedeltaformat }}
                             </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="text-center ">{{ user.username }} hasn't completed any quizzes yet.</p>
        {% endif %}
    </div>
</div>

<div class="mt-4">
    <a href="{{ url_for('admin.summary') }}" class="btn btn-secondary">&laquo; Back to Summary</a>
</div>

{% endblock %}